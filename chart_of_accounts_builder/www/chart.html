<!-- no-cache -->

{% if frappe.user == "Guest" %}
<div class='alert alert-warning'>Please <a href="/login">login</a> to fork and edit this chart</div>
{% endif %}

{% if frappe.user != "Guest" %}
	{% if frappe.form_dict.forked == "0" or frappe.form_dict.submitted == "1" %}
		<button class="btn btn-default btn-sm pull-right star-button" 
			style="margin-left: 5px; margin-top: 4px">
				<span class="octicon octicon-star"></span>
				<span class="text">Star</span>
				<span class="star-count">{{ stars }}</span>
		</button>
		<button class="btn btn-default btn-sm pull-right fork-button" style="margin-top: 4px">
			<span class="octicon octicon-repo-forked"></span>
			<span class="text">Fork</span>
		</button>

	{% elif frappe.form_dict.forked == "1" and frappe.form_dict.submitted == "0" %}
		<p><button class="btn btn-primary btn-accept btn-sm pull-right submit-chart" 
			style="margin-right: 5px;">
			<span class="octicon octicon-check"></span>
			<span class="text">Submit</span>
		</button></p>
	{% endif %}
{% endif %}

{% macro render_node(parent) %}
<ul>
{% for account in accounts %}
	{% if (account.parent_account or "") == parent %}
	<li>
		<span class="tree-link"
			data-name="{{ account.name }}"
            data-account-name="{{ account.account_name }}"
			data-parent-account="{{ account.parent_account }}"
            data-account-type="{{ account.account_type }}"
			data-company="{{ account.company }}"
            data-is-group="{{ account.is_group }}"
            data-root-type="{{ account.root_type }}"
			data-tax-rate="{{ account.tax_rate }}">
				{{ account.account_name }}
		</span>
		{% if account.is_group %}
			{{ render_node(account.name) }}
		{% endif %}
	</li>
	{% endif %}
{% endfor %}
</ul>
{% endmacro %}

{% block style %}
<style>
    {% include "frappe/public/css/tree.css" %}
</style>
{% endblock %}

<!-- title: {{ frappe.form_dict.company }} -->

<h1 style="margin-top: 10px">{{ frappe.form_dict.company }}</h1>

<hr>

<div class="tree" style="margin-left: -55px;">
	{{ render_node("") }}
	<ul><li>
		<br>
		<p><button class="btn btn-default btn-sm add-root-button">
			<span class="octicon octicon-plus"></span>
			<span class="text">Add root account</span>
		</button></p>
	</li></ul>
	
</div>
